<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè¶ RWA DEX - Judge Demo (3-Minute Flow)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .demo-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .demo-timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .demo-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .step-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
            position: relative;
        }
        .step-card:hover {
            transform: translateY(-2px);
        }
        .step-card.completed {
            border: 2px solid #28a745;
            background: linear-gradient(to right, #e8f5e8, #f8fff8);
        }
        .step-card.active {
            border: 2px solid #007bff;
            background: linear-gradient(to right, #e3f2fd, #f8fdff);
        }
        .step-number {
            position: absolute;
            top: -10px;
            left: 20px;
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .step-card.completed .step-number {
            background: #28a745;
        }
        .step-title {
            margin: 10px 0 15px;
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }
        .wallet-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }
        .status-connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-wrong-network {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.2s ease;
            margin: 5px;
            min-width: 140px;
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }
        .btn-demo {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }
        .rwa-marketplace {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .rwa-asset {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .rwa-asset:hover {
            background: linear-gradient(135deg, #e3f2fd, #f8fdff);
            border-color: #007bff;
            transform: translateY(-2px);
        }
        .rwa-asset.selected {
            background: linear-gradient(135deg, #e8f5e8, #f8fff8);
            border: 2px solid #28a745;
        }
        .asset-type {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 0.8em;
        }
        .asset-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #333;
        }
        .asset-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
        }
        .asset-value {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        .ai-insights {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .ai-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
        }
        .score-bar {
            width: 100px;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        .score-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        .score-good { background: #28a745; }
        .score-medium { background: #ffc107; }
        .score-bad { background: #dc3545; }
        .yield-dashboard {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        .yield-stat {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.1em;
        }
        .yield-amount {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #28a745;
        }
        .loading {
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            animation: fadeIn 0.3s ease;
        }
        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            animation: fadeIn 0.3s ease;
        }
        .fallback-notice {
            background: #e2e3e5;
            border: 1px solid #d6d8db;
            color: #383d41;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9em;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .demo-highlight {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .compliance-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .compliance-verified {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .compliance-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .lending-preview {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        .collateral-ratio {
            font-size: 1.2em;
            font-weight: bold;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="demo-timer">
        <div>‚è±Ô∏è Demo Timer</div>
        <div id="timer">03:00</div>
    </div>

    <div class="demo-container">
        <div class="demo-header">
            <h1>üè¶ RWA DEX - Real World Asset Exchange</h1>
            <p>Complete Web3 platform for tokenized real-world assets on Mantle Sepolia</p>
        </div>

        <div class="demo-steps">
            <!-- Step 1: Wallet Connection -->
            <div class="step-card" id="step1">
                <div class="step-number">1</div>
                <h3 class="step-title">üîó Wallet Connection</h3>
                
                <div id="walletStatus" class="wallet-status status-disconnected">
                    üî¥ MetaMask Disconnected
                </div>
                
                <div style="margin: 15px 0;">
                    <div><strong>Address:</strong> <span id="walletAddress">Not connected</span></div>
                    <div><strong>Network:</strong> <span id="networkInfo">Unknown</span></div>
                    <div><strong>Balance:</strong> <span id="walletBalance">0 MNT</span></div>
                </div>

                <div>
                    <button id="connectBtn" class="btn">Connect MetaMask</button>
                    <button id="disconnectBtn" class="btn" style="display: none;">Disconnect</button>
                    <button id="switchNetworkBtn" class="btn btn-warning" style="display: none;">Switch to Mantle Sepolia</button>
                </div>
                
                <div class="fallback-notice" id="metamaskFallback" style="display: none;">
                    ‚ö†Ô∏è Demo Mode: MetaMask not detected. Using simulated wallet.
                </div>
            </div>

            <!-- Step 2: Compliance Status -->
            <div class="step-card" id="step2">
                <div class="step-number">2</div>
                <h3 class="step-title">üõ°Ô∏è Compliance & KYC</h3>
                
                <div id="complianceStatus" class="compliance-status compliance-pending">
                    ‚è≥ Checking compliance status...
                </div>
                
                <div id="complianceDetails" style="display: none;">
                    <div><strong>KYC Level:</strong> <span id="kycLevel">Level 2</span></div>
                    <div><strong>Jurisdiction:</strong> <span id="jurisdiction">United States</span></div>
                    <div><strong>Verified:</strong> <span id="verificationDate">2024-01-08</span></div>
                </div>

                <button id="verifyComplianceBtn" class="btn btn-demo">Verify Compliance</button>
            </div>

            <!-- Step 3: RWA Marketplace -->
            <div class="step-card" id="step3">
                <div class="step-number">3</div>
                <h3 class="step-title">üè™ RWA Marketplace</h3>
                
                <div id="marketplaceLoading" class="loading">
                    <div class="spinner"></div>
                    Loading marketplace...
                </div>
                
                <div id="rwaMarketplace" class="rwa-marketplace" style="display: none;">
                    <!-- Will be populated with RWA assets -->
                </div>
                
                <button id="loadMarketplaceBtn" class="btn btn-demo" disabled>Load Marketplace</button>
            </div>

            <!-- Step 4: AI Analysis -->
            <div class="step-card" id="step4">
                <div class="step-number">4</div>
                <h3 class="step-title">ü§ñ AI Fair Value & Risk</h3>
                
                <div id="aiAnalysis" style="display: none;">
                    <div class="ai-insights">
                        <div class="ai-score">
                            <span><strong>Fair Value Score:</strong></span>
                            <div class="score-bar">
                                <div class="score-fill score-good" style="width: 85%"></div>
                            </div>
                            <span>85/100</span>
                        </div>
                        <div class="ai-score">
                            <span><strong>Risk Score:</strong></span>
                            <div class="score-bar">
                                <div class="score-fill score-medium" style="width: 35%"></div>
                            </div>
                            <span>35/100</span>
                        </div>
                        <div class="ai-score">
                            <span><strong>Liquidity Score:</strong></span>
                            <div class="score-bar">
                                <div class="score-fill score-good" style="width: 72%"></div>
                            </div>
                            <span>72/100</span>
                        </div>
                    </div>
                    
                    <div id="priceRecommendation">
                        <strong>üí° AI Recommendation:</strong> 
                        Current price $2,340 is <span style="color: #28a745;">12% below</span> fair value of $2,640
                    </div>
                </div>
                
                <button id="analyzeAssetBtn" class="btn btn-demo" disabled>Analyze Selected Asset</button>
            </div>

            <!-- Step 5: Purchase RWA Token -->
            <div class="step-card" id="step5">
                <div class="step-number">5</div>
                <h3 class="step-title">üí∞ Purchase RWA Token</h3>
                
                <div id="purchaseForm" style="display: none;">
                    <div style="margin: 15px 0;">
                        <label><strong>Selected Asset:</strong></label>
                        <div id="selectedAsset" style="color: #007bff; font-weight: bold;">Manhattan Office Building #1</div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label><strong>Purchase Amount:</strong></label>
                        <input type="number" id="purchaseAmount" value="1000" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" />
                        <small style="color: #666;">Minimum: $1,000 USD</small>
                    </div>
                    
                    <div id="purchasePreview" style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <div><strong>Tokens to receive:</strong> <span id="tokensToReceive">0.427</span> RWATOK</div>
                        <div><strong>Platform fee (0.5%):</strong> <span id="platformFee">$5.00</span></div>
                        <div><strong>Total cost:</strong> <span id="totalCost">$1,005.00</span></div>
                    </div>
                </div>
                
                <button id="buyTokenBtn" class="btn btn-success" disabled>Buy RWA Token</button>
                <button id="simulatePurchaseBtn" class="btn btn-demo" disabled>Simulate Purchase</button>
            </div>

            <!-- Step 6: Yield Dashboard -->
            <div class="step-card" id="step6">
                <div class="step-number">6</div>
                <h3 class="step-title">üìà Yield Dashboard</h3>
                
                <div id="yieldDashboard" style="display: none;">
                    <div class="yield-dashboard">
                        <div class="yield-stat">
                            <span><strong>Current APY:</strong></span>
                            <span class="yield-amount">8.5%</span>
                        </div>
                        <div class="yield-stat">
                            <span><strong>Accumulated Yield:</strong></span>
                            <span class="yield-amount" id="accumulatedYield">$127.50</span>
                        </div>
                        <div class="yield-stat">
                            <span><strong>Next Distribution:</strong></span>
                            <span>Jan 15, 2026</span>
                        </div>
                    </div>
                </div>
                
                <button id="claimYieldBtn" class="btn btn-success" disabled>Claim Yield ($127.50)</button>
                <button id="showYieldBtn" class="btn btn-demo" disabled>Show Yield Details</button>
            </div>

            <!-- Step 7: Lending Preview (Bonus) -->
            <div class="step-card" id="step7">
                <div class="step-number">7</div>
                <h3 class="step-title">üèõÔ∏è Use as Collateral (Preview)</h3>
                
                <div id="lendingPreview" style="display: none;">
                    <div class="lending-preview">
                        <div><strong>Available Collateral:</strong> $1,000 (0.427 RWATOK)</div>
                        <div><strong>Max Borrowing Power:</strong> $750 (75% LTV)</div>
                        <div class="collateral-ratio">Collateral Ratio: 133%</div>
                        <div style="margin-top: 10px;">
                            <small>Interest Rate: 5.5% APR ‚Ä¢ Liquidation: 110%</small>
                        </div>
                    </div>
                </div>
                
                <button id="previewLendingBtn" class="btn btn-demo" disabled>Preview Borrowing</button>
            </div>
        </div>

        <div id="messages"></div>

        <div class="demo-highlight">
            <strong>üéØ Demo Complete!</strong> You've experienced the full RWA DEX platform:
            Wallet connection ‚Üí Compliance verification ‚Üí Marketplace browsing ‚Üí AI analysis ‚Üí Token purchase ‚Üí Yield claiming ‚Üí Lending preview
        </div>
    </div>

    <script>
        // Demo state management
        let demoState = {
            walletConnected: false,
            correctNetwork: false,
            complianceVerified: false,
            selectedAsset: null,
            marketplaceLoaded: false,
            aiAnalysisShown: false,
            tokenPurchased: false,
            yieldShown: false,
            startTime: null
        };

        // Demo timer
        let timeRemaining = 180; // 3 minutes
        const timerElement = document.getElementById('timer');
        let timerInterval;

        function startTimer() {
            demoState.startTime = new Date();
            timerInterval = setInterval(() => {
                timeRemaining--;
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    showMessage('‚è∞ Demo time completed! Great job!', 'success');
                }
                
                // Change timer color when time is running low
                if (timeRemaining <= 30) {
                    timerElement.style.color = '#dc3545';
                } else if (timeRemaining <= 60) {
                    timerElement.style.color = '#ffc107';
                }
            }, 1000);
        }

        // Mock RWA assets with instant fallback data
        const mockAssets = [
            {
                id: 1,
                name: "Manhattan Office Building #1",
                type: "Real Estate",
                price: 2340,
                apy: 8.5,
                totalValue: 12500000,
                tokens: 5342,
                aiScore: 85,
                riskScore: 35,
                liquidityScore: 72
            },
            {
                id: 2,
                name: "US Treasury Bond Pool",
                type: "Government Bonds",
                price: 1000,
                apy: 4.2,
                totalValue: 8750000,
                tokens: 8750,
                aiScore: 95,
                riskScore: 15,
                liquidityScore: 88
            },
            {
                id: 3,
                name: "Invoice Factoring Fund #3",
                type: "Invoices",
                price: 105,
                apy: 12.8,
                totalValue: 2100000,
                tokens: 20000,
                aiScore: 78,
                riskScore: 55,
                liquidityScore: 65
            }
        ];

        // Utility functions
        function showMessage(message, type = 'success') {
            const messagesContainer = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.className = `${type === 'success' ? 'success-message' : 'error-message'}`;
            messageElement.textContent = message;
            messagesContainer.appendChild(messageElement);
            
            setTimeout(() => {
                if (messageElement.parentNode) {
                    messageElement.remove();
                }
            }, 3000);
        }

        function updateStepStatus(stepNumber, status) {
            const stepCard = document.getElementById(`step${stepNumber}`);
            stepCard.className = `step-card ${status}`;
        }

        function formatAddress(address) {
            if (!address) return 'Not connected';
            return `${address.slice(0, 6)}...${address.slice(-4)}`;
        }

        // Mock wallet connection with instant fallbacks
        async function connectWallet() {
            const connectBtn = document.getElementById('connectBtn');
            const walletStatus = document.getElementById('walletStatus');
            const walletAddress = document.getElementById('walletAddress');
            const networkInfo = document.getElementById('networkInfo');
            const walletBalance = document.getElementById('walletBalance');
            const metamaskFallback = document.getElementById('metamaskFallback');

            connectBtn.disabled = true;
            connectBtn.textContent = 'Connecting...';
            
            // Check if MetaMask is available
            if (typeof window.ethereum === 'undefined') {
                // Fallback: Simulate connection for demo
                setTimeout(() => {
                    demoState.walletConnected = true;
                    demoState.correctNetwork = true;
                    
                    walletStatus.className = 'wallet-status status-connected';
                    walletStatus.innerHTML = 'üü¢ Demo Wallet Connected';
                    walletAddress.textContent = formatAddress('0x742d35Cc7970C1C2dE54DfB8b3E82F0F68659C03');
                    networkInfo.textContent = 'Mantle Sepolia (Demo)';
                    walletBalance.textContent = '2.5 MNT';
                    
                    metamaskFallback.style.display = 'block';
                    connectBtn.style.display = 'none';
                    document.getElementById('disconnectBtn').style.display = 'inline-block';
                    
                    updateStepStatus(1, 'completed');
                    enableNextSteps();
                    showMessage('Demo wallet connected successfully!', 'success');
                    
                    if (!demoState.startTime) startTimer();
                }, 800);
                return;
            }

            try {
                // Real MetaMask connection
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                const chainId = await window.ethereum.request({
                    method: 'eth_chainId'
                });
                
                const isCorrectNetwork = parseInt(chainId, 16) === 5003;
                
                demoState.walletConnected = true;
                demoState.correctNetwork = isCorrectNetwork;
                
                walletStatus.className = `wallet-status ${isCorrectNetwork ? 'status-connected' : 'status-wrong-network'}`;
                walletStatus.innerHTML = isCorrectNetwork ? 'üü¢ MetaMask Connected' : 'üü° Wrong Network';
                walletAddress.textContent = formatAddress(accounts[0]);
                networkInfo.textContent = isCorrectNetwork ? 'Mantle Sepolia' : `Chain ${parseInt(chainId, 16)}`;
                
                // Get balance
                try {
                    const balance = await window.ethereum.request({
                        method: 'eth_getBalance',
                        params: [accounts[0], 'latest']
                    });
                    walletBalance.textContent = `${(parseInt(balance, 16) / 1e18).toFixed(4)} MNT`;
                } catch {
                    walletBalance.textContent = '0 MNT';
                }
                
                connectBtn.style.display = 'none';
                document.getElementById('disconnectBtn').style.display = 'inline-block';
                
                if (isCorrectNetwork) {
                    updateStepStatus(1, 'completed');
                    enableNextSteps();
                    showMessage('MetaMask connected successfully!', 'success');
                } else {
                    document.getElementById('switchNetworkBtn').style.display = 'inline-block';
                    showMessage('Please switch to Mantle Sepolia network', 'error');
                }
                
                if (!demoState.startTime) startTimer();
                
            } catch (error) {
                showMessage('Failed to connect MetaMask. Using demo mode.', 'error');
                // Fallback to demo mode
                setTimeout(() => connectWallet(), 500);
            } finally {
                connectBtn.disabled = false;
                connectBtn.textContent = 'Connect MetaMask';
            }
        }

        // Enable next steps after wallet connection
        function enableNextSteps() {
            document.getElementById('verifyComplianceBtn').disabled = false;
            document.getElementById('loadMarketplaceBtn').disabled = false;
            updateStepStatus(2, 'active');
        }

        // Verify compliance (always succeeds for demo)
        function verifyCompliance() {
            const btn = document.getElementById('verifyComplianceBtn');
            const status = document.getElementById('complianceStatus');
            const details = document.getElementById('complianceDetails');
            
            btn.disabled = true;
            btn.textContent = 'Verifying...';
            
            setTimeout(() => {
                demoState.complianceVerified = true;
                
                status.className = 'compliance-status compliance-verified';
                status.innerHTML = '‚úÖ KYC Verified - Level 2';
                details.style.display = 'block';
                
                updateStepStatus(2, 'completed');
                updateStepStatus(3, 'active');
                
                btn.textContent = '‚úÖ Verified';
                showMessage('Compliance verification complete!', 'success');
                
            }, 1200);
        }

        // Load marketplace with instant fallback
        function loadMarketplace() {
            const btn = document.getElementById('loadMarketplaceBtn');
            const loading = document.getElementById('marketplaceLoading');
            const marketplace = document.getElementById('rwaMarketplace');
            
            btn.disabled = true;
            loading.style.display = 'flex';
            
            setTimeout(() => {
                demoState.marketplaceLoaded = true;
                
                // Populate marketplace
                marketplace.innerHTML = mockAssets.map(asset => `
                    <div class="rwa-asset" data-asset-id="${asset.id}" onclick="selectAsset(${asset.id})">
                        <div class="asset-type">${asset.type}</div>
                        <div class="asset-name">${asset.name}</div>
                        <div class="asset-details">
                            <div>Price: <span class="asset-value">$${asset.price.toLocaleString()}</span></div>
                            <div>APY: <span class="asset-value">${asset.apy}%</span></div>
                            <div>Total Value: <span class="asset-value">$${(asset.totalValue / 1000000).toFixed(1)}M</span></div>
                            <div>Available: <span class="asset-value">${asset.tokens.toLocaleString()}</span></div>
                        </div>
                    </div>
                `).join('');
                
                loading.style.display = 'none';
                marketplace.style.display = 'grid';
                
                updateStepStatus(3, 'completed');
                updateStepStatus(4, 'active');
                
                btn.textContent = '‚úÖ Loaded';
                document.getElementById('analyzeAssetBtn').disabled = false;
                
                showMessage('Marketplace loaded! Click on an asset to select it.', 'success');
                
            }, 800);
        }

        // Select asset in marketplace
        function selectAsset(assetId) {
            // Remove previous selection
            document.querySelectorAll('.rwa-asset').forEach(el => el.classList.remove('selected'));
            
            // Add selection to clicked asset
            event.target.closest('.rwa-asset').classList.add('selected');
            
            demoState.selectedAsset = mockAssets.find(asset => asset.id === assetId);
            
            // Update related UI elements
            document.getElementById('selectedAsset').textContent = demoState.selectedAsset.name;
            document.getElementById('analyzeAssetBtn').disabled = false;
            document.getElementById('simulatePurchaseBtn').disabled = false;
            document.getElementById('purchaseForm').style.display = 'block';
            
            updatePurchasePreview();
            showMessage(`Selected: ${demoState.selectedAsset.name}`, 'success');
        }

        // Update purchase preview
        function updatePurchasePreview() {
            if (!demoState.selectedAsset) return;
            
            const amount = parseFloat(document.getElementById('purchaseAmount').value) || 1000;
            const tokensToReceive = amount / demoState.selectedAsset.price;
            const platformFee = amount * 0.005;
            const totalCost = amount + platformFee;
            
            document.getElementById('tokensToReceive').textContent = tokensToReceive.toFixed(3);
            document.getElementById('platformFee').textContent = `$${platformFee.toFixed(2)}`;
            document.getElementById('totalCost').textContent = `$${totalCost.toLocaleString()}`;
        }

        // Show AI analysis
        function showAIAnalysis() {
            const btn = document.getElementById('analyzeAssetBtn');
            const analysis = document.getElementById('aiAnalysis');
            
            if (!demoState.selectedAsset) {
                showMessage('Please select an asset first!', 'error');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Analyzing...';
            
            setTimeout(() => {
                demoState.aiAnalysisShown = true;
                analysis.style.display = 'block';
                
                // Update AI scores based on selected asset
                const asset = demoState.selectedAsset;
                document.querySelector('.score-good').style.width = `${asset.aiScore}%`;
                document.querySelector('.score-medium').style.width = `${asset.riskScore}%`;
                document.querySelectorAll('.score-good')[1].style.width = `${asset.liquidityScore}%`;
                
                // Update recommendation
                const fairValue = asset.price * 1.12;
                document.getElementById('priceRecommendation').innerHTML = 
                    `<strong>üí° AI Recommendation:</strong> Current price $${asset.price.toLocaleString()} is <span style="color: #28a745;">12% below</span> fair value of $${fairValue.toLocaleString()}`;
                
                updateStepStatus(4, 'completed');
                updateStepStatus(5, 'active');
                
                btn.textContent = '‚úÖ Analysis Complete';
                document.getElementById('buyTokenBtn').disabled = false;
                
                showMessage('AI analysis complete! Asset is undervalued.', 'success');
                
            }, 1500);
        }

        // Simulate purchase
        function simulatePurchase() {
            const btn = document.getElementById('simulatePurchaseBtn');
            
            if (!demoState.selectedAsset) {
                showMessage('Please select an asset first!', 'error');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Processing...';
            
            setTimeout(() => {
                demoState.tokenPurchased = true;
                
                updateStepStatus(5, 'completed');
                updateStepStatus(6, 'active');
                
                btn.textContent = '‚úÖ Purchase Complete';
                document.getElementById('showYieldBtn').disabled = false;
                document.getElementById('claimYieldBtn').disabled = false;
                
                showMessage('üéâ Token purchase successful! You now own RWA tokens.', 'success');
                
            }, 1200);
        }

        // Show yield dashboard
        function showYieldDashboard() {
            const btn = document.getElementById('showYieldBtn');
            const dashboard = document.getElementById('yieldDashboard');
            
            btn.disabled = true;
            btn.textContent = 'Loading...';
            
            setTimeout(() => {
                demoState.yieldShown = true;
                dashboard.style.display = 'block';
                
                updateStepStatus(6, 'completed');
                updateStepStatus(7, 'active');
                
                btn.textContent = '‚úÖ Yield Loaded';
                document.getElementById('previewLendingBtn').disabled = false;
                
                showMessage('Yield dashboard loaded! You have claimable yield.', 'success');
                
            }, 800);
        }

        // Claim yield
        function claimYield() {
            const btn = document.getElementById('claimYieldBtn');
            
            btn.disabled = true;
            btn.textContent = 'Claiming...';
            
            setTimeout(() => {
                document.getElementById('accumulatedYield').textContent = '$0.00';
                btn.textContent = '‚úÖ Yield Claimed';
                
                showMessage('üéâ Yield claimed successfully! $127.50 transferred to your wallet.', 'success');
                
            }, 1000);
        }

        // Preview lending
        function previewLending() {
            const btn = document.getElementById('previewLendingBtn');
            const preview = document.getElementById('lendingPreview');
            
            btn.disabled = true;
            btn.textContent = 'Loading...';
            
            setTimeout(() => {
                preview.style.display = 'block';
                btn.textContent = '‚úÖ Preview Loaded';
                
                showMessage('Lending preview loaded! You can borrow up to $750 against your RWA tokens.', 'success');
                
                // Demo complete
                setTimeout(() => {
                    showMessage('üéØ Demo completed successfully! All features demonstrated.', 'success');
                    clearInterval(timerInterval);
                }, 500);
                
            }, 800);
        }

        // Event listeners
        document.getElementById('connectBtn').addEventListener('click', connectWallet);
        document.getElementById('verifyComplianceBtn').addEventListener('click', verifyCompliance);
        document.getElementById('loadMarketplaceBtn').addEventListener('click', loadMarketplace);
        document.getElementById('analyzeAssetBtn').addEventListener('click', showAIAnalysis);
        document.getElementById('simulatePurchaseBtn').addEventListener('click', simulatePurchase);
        document.getElementById('showYieldBtn').addEventListener('click', showYieldDashboard);
        document.getElementById('claimYieldBtn').addEventListener('click', claimYield);
        document.getElementById('previewLendingBtn').addEventListener('click', previewLending);

        // Update purchase preview on amount change
        document.getElementById('purchaseAmount').addEventListener('input', updatePurchasePreview);

        // Switch network function
        document.getElementById('switchNetworkBtn').addEventListener('click', async () => {
            if (typeof window.ethereum === 'undefined') return;
            
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x138B' }]
                });
            } catch (error) {
                if (error.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: '0x138B',
                            chainName: 'Mantle Sepolia',
                            rpcUrls: ['https://rpc.sepolia.mantle.xyz'],
                            blockExplorerUrls: ['https://explorer.sepolia.mantle.xyz'],
                            nativeCurrency: {
                                name: 'MNT',
                                symbol: 'MNT',
                                decimals: 18
                            }
                        }]
                    });
                }
            }
        });

        // Auto-start demo if MetaMask is already connected
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.request({ method: 'eth_accounts' })
                .then(accounts => {
                    if (accounts.length > 0) {
                        connectWallet();
                    }
                })
                .catch(() => {
                    // Ignore errors, let user manually connect
                });
        }

        // Initialize UI
        updateStepStatus(1, 'active');
    </script>
</body>
</html>